package org.opentestsystem.ap.imrt.iss.dto;


import org.junit.Before;
import org.junit.Test;
import org.opentestsystem.ap.common.model.Item;
import org.opentestsystem.ap.imrt.common.model.BaseItem;
import org.opentestsystem.ap.imrt.common.model.ImrtItem;
import org.opentestsystem.ap.imrt.iss.builder.ImrtItemBuilder;

import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.Mockito.mock;

public class ItemDtoConverterTest {
    private ItemDtoConverter mapper;

    @Before
    public void setUp() {
        mapper = new ItemDtoConverter();
    }

    @Test
    public void shouldMapToItemDto() {
        ImrtItem item = new ImrtItemBuilder()
                .build();

        ItemDto dto = mapper.convert(item);

        validateItem(dto, item);
        assertThat(dto.getItemDetail()).isNotPresent();
    }

    @Test
    public void shouldMapToItemDtoWithItem() {
        Item itemJson = mock(Item.class);
        ImrtItem item = new ImrtItemBuilder().withItemJson(itemJson).build();

        ItemDto dto = mapper.mapWithDetail(item);

        validateItem(dto, item);
        assertThat(dto.getItemDetail()).isPresent();
        assertThat(dto.getItemDetail().get()).isEqualTo(itemJson);
    }

    private void validateItem(ItemDto dto, BaseItem item) {
        assertThat(dto.getId()).isEqualTo(item.getId());
        assertThat(dto.getDepthOfKnowledge()).isEqualTo(item.getDepthOfKnowledge());
        assertThat(dto.getCreatedAt()).isEqualTo(item.getItemCreatedAt());
        assertThat(dto.getGrade()).isEqualTo(item.getGrade());
        assertThat(dto.getItemType()).isEqualTo(item.getItemType());
        assertThat(dto.getWorkflowStatus()).isEqualTo(item.getWorkflowStatus());
        assertThat(dto.getSubject()).isEqualTo(item.getSubject());
        assertThat(dto.getStimulusId()).isEqualTo(item.getAssociatedStimulusId());
        assertThat(dto.getOrganizationTypeId()).isEqualTo(item.getOrganizationTypeId());
        assertThat(dto.getOrganizationName()).isEqualTo(item.getOrganizationName());
        assertThat(dto.isBeingCreated()).isTrue();
        assertThat(dto.getContentTaskModel()).isEqualTo(item.getContentTaskModel());

        assertThat(dto.getPrimaryClaim()).isEqualTo(item.getPrimaryClaim());
        assertThat(dto.getPrimaryAssessmentTarget()).isEqualTo(item.getPrimaryTarget());
        assertThat(dto.getPrimaryCommonCoreStandard()).isEqualTo(item.getPrimaryCommonCoreStandard());
        assertThat(dto.getPrimaryContentDomain()).isEqualTo(item.getPrimaryContentDomain());

        assertThat(dto.getSecondaryClaim()).isEqualTo(item.getSecondaryClaim());
        assertThat(dto.getSecondaryAssessmentTarget()).isEqualTo(item.getSecondaryTarget());
        assertThat(dto.getSecondaryCommonCoreStandard()).isEqualTo(item.getSecondaryCommonCoreStandard());
        assertThat(dto.getSecondaryContentDomain()).isEqualTo(item.getSecondaryContentDomain());

        assertThat(dto.getTertiaryClaim()).isEqualTo(item.getTertiaryClaim());
        assertThat(dto.getTertiaryAssessmentTarget()).isEqualTo(item.getTertiaryTarget());
        assertThat(dto.getTertiaryCommonCoreStandard()).isEqualTo(item.getTertiaryCommonCoreStandard());
        assertThat(dto.getTertiaryContentDomain()).isEqualTo(item.getTertiaryContentDomain());

        assertThat(dto.getQuaternaryClaim()).isEqualTo(item.getQuaternaryClaim());
        assertThat(dto.getQuaternaryAssessmentTarget()).isEqualTo(item.getQuaternaryTarget());
        assertThat(dto.getQuaternaryCommonCoreStandard()).isEqualTo(item.getQuaternaryCommonCoreStandard());
        assertThat(dto.getQuaternaryContentDomain()).isEqualTo(item.getQuaternaryContentDomain());
    }
}