package org.opentestsystem.ap.imrt.iss.model;

import org.junit.Test;
import org.opentestsystem.ap.imrt.iss.dto.search.SearchProperty;

import java.util.Collections;
import java.util.List;

import static org.assertj.core.api.Assertions.assertThat;
import static org.assertj.core.api.Assertions.entry;

public class MatchSearchFilterTest {
    @Test
    public void shouldCreateQueryForValues() {
        MatchSearchFilter filter = new MatchSearchFilter(SearchProperty.SUBJECT.getProperty(), Collections.singletonList("3"));

        FilterQuery query = filter.getFilterQuery();

        assertThat(query.getQuery()).isEqualTo("subject IN (:subject) ");
        assertThat(query.getMapSqlProperties()).contains(entry(SearchProperty.SUBJECT.getProperty(), filter.getFilterValues()));
    }

    @Test
    @SuppressWarnings("unchecked")
    public void shouldCreateQueryForValuesIncludingBlank() {
        MatchSearchFilter filter = new MatchSearchFilter(SearchProperty.SUBJECT.getProperty(), Collections.singletonList("3"), true);

        FilterQuery query = filter.getFilterQuery();

        assertThat(query.getQuery()).isEqualTo("subject IN (:subject) ");

        assertThat(((List<String>) query.getMapSqlProperties().get(SearchProperty.SUBJECT.getProperty()))).containsExactly("3", "");
    }
}