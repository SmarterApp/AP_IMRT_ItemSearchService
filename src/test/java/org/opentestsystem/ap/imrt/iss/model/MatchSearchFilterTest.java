package org.opentestsystem.ap.imrt.iss.model;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mock;
import org.mockito.runners.MockitoJUnitRunner;

import java.util.Collections;
import java.util.List;

import static org.assertj.core.api.Assertions.assertThat;
import static org.opentestsystem.ap.imrt.iss.dto.search.SearchProperty.SUBJECT;

@RunWith(MockitoJUnitRunner.class)
public class MatchSearchFilterTest {

    @Mock
    private SearchPermissions searchPermissions;

    @Test
    @SuppressWarnings("unchecked")
    public void shouldCreateQueryForValues() {
        MatchSearchFilter filter = new MatchSearchFilter(SUBJECT, Collections.singletonList("3"));

        FilterQuery query = filter.getFilterQuery(searchPermissions).get();

        assertThat(query.getQuery()).isEqualTo("subject IN (:subject) ");
        assertThat(query.getMapSqlProperties()).containsKeys(SUBJECT.getProperty());
        assertThat((List) query.getMapSqlProperties().get(SUBJECT.getProperty())).containsExactly("3");
    }

    @Test
    @SuppressWarnings("unchecked")
    public void shouldCreateQueryForValuesIncludingBlank() {
        MatchSearchFilter filter = new MatchSearchFilter(SUBJECT, Collections.singletonList("3"), true);

        FilterQuery query = filter.getFilterQuery(searchPermissions).get();

        assertThat(query.getQuery()).isEqualTo("subject IN (:subject) ");

        assertThat(((List<String>) query.getMapSqlProperties().get(SUBJECT.getProperty()))).containsExactly("3", "");
    }
}