package org.opentestsystem.ap.imrt.iss.controller;

import org.opentestsystem.ap.imrt.iss.dto.ItemDto;
import org.opentestsystem.ap.imrt.iss.dto.ItemDtoMapper;
import org.opentestsystem.ap.imrt.iss.dto.StandardIdDtoMapper;
import org.opentestsystem.ap.imrt.iss.dto.search.SearchRequest;
import org.opentestsystem.ap.imrt.iss.service.ItemSearchService;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.Collection;

@RestController
@RequestMapping("v1/items")
public class ItemSearchController {
    private final ItemSearchService itemSearchService;
    private final ItemDtoMapper itemDtoMapper;

    public ItemSearchController(final ItemSearchService itemSearchService) {
        this.itemSearchService = itemSearchService;
        this.itemDtoMapper = new ItemDtoMapper(new StandardIdDtoMapper());
    }

    /**
     * General Search endpoint
     *
     * @param searchCriteria {@link SearchRequest} containing the necessary filters
     * @return Collection of {@link ItemDto}
     */
    @PostMapping("/search")
    Collection<ItemDto> search(@RequestBody SearchRequest searchCriteria) {
        return itemDtoMapper.map(itemSearchService.searchItems(searchCriteria));
    }
}
